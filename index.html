<!DOCTYPE html>
<html>
<head>
    <title>3D Car Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #scoreDiv { position: absolute; top: 10px; left: 10px; color: white; font-size: 20px; font-family: Arial; }
        #startPage { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        #gameTitle { font-size: 40px; font-family: Arial; }
        #playBtn { padding: 10px 20px; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="scoreDiv">Score: <span id="score">0</span></div>
    <div id="startPage">
        <div id="gameTitle">3D Car Drive</div>
        <button id="playBtn">Play</button>
        <p>Swipe left/right or use arrow keys to move the car</p>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Texture for road (simple base64 image)
        const roadTexture = new THREE.TextureLoader().load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==');
        const roadMaterial = new THREE.MeshBasicMaterial({ map: roadTexture, color: 0x666666 });
        const roadGeometry = new THREE.PlaneGeometry(10, 100);
        const road = new THREE.Mesh(roadGeometry, roadMaterial);
        road.rotation.x = -Math.PI / 2;
        road.position.y = -0.5;
        scene.add(road);

        // Car (detailed shape with texture)
        const carGeometry = new THREE.BoxGeometry(1.5, 0.7, 3);
        const carTexture = new THREE.TextureLoader().load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==');
        const carMaterial = new THREE.MeshBasicMaterial({ map: carTexture, color: 0xff4500 });
        const car = new THREE.Mesh(carGeometry, carMaterial);
        car.position.set(0, 0.4, -5);
        scene.add(car);

        // Houses (cubes with texture)
        const houseGeometry = new THREE.BoxGeometry(2, 3, 2);
        const houseTexture = new THREE.TextureLoader().load('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==');
        const houseMaterial = new THREE.MeshBasicMaterial({ map: houseTexture, color: 0x666666 });
        const houses = [];
        for (let i = 0; i < 5; i++) {
            const house = new THREE.Mesh(houseGeometry, houseMaterial);
            house.position.set((Math.random() - 0.5) * 8, 1.5, -20 - i * 10);
            scene.add(house);
            houses.push(house);
        }

        // Pedestrians (spheres)
        const pedGeometry = new THREE.SphereGeometry(0.3, 32, 32);
        const pedMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
        const pedestrians = [];
        for (let i = 0; i < 3; i++) {
            const ped = new THREE.Mesh(pedGeometry, pedMaterial);
            ped.position.set((Math.random() - 0.5) * 8, 0.3, -30 - i * 15);
            scene.add(ped);
            pedestrians.push(ped);
        }

        // Skybox (simple planes)
        const skyGeometry = new THREE.PlaneGeometry(100, 100);
        const skyMaterial = new THREE.MeshBasicMaterial({ color: 0x87ceeb, side: THREE.DoubleSide });
        const sky = new THREE.Mesh(skyGeometry, skyMaterial);
        sky.position.y = 50;
        sky.rotation.x = -Math.PI / 2;
        scene.add(sky);

        camera.position.set(0, 5, 0);
        camera.lookAt(0, 0, -5);

        let carX = 0;
        let score = 0;
        let gameActive = false;
        let touchStartX = 0;

        // Touch controls
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });
        document.addEventListener('touchmove', (e) => {
            const deltaX = e.touches[0].clientX - touchStartX;
            carX += deltaX * 0.02;
            carX = Math.max(-4, Math.min(4, carX));
            touchStartX = e.touches[0].clientX;
        });

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') carX -= 0.2;
            if (e.key === 'ArrowRight') carX += 0.2;
            carX = Math.max(-4, Math.min(4, carX));
        });

        // Start game
        document.getElementById('playBtn').addEventListener('click', () => {
            document.getElementById('startPage').style.display = 'none';
            gameActive = true;
        });

        function animate() {
            requestAnimationFrame(animate);
            if (!gameActive) return;

            road.position.z += 0.1;
            if (road.position.z > 50) road.position.z -= 100;

            houses.forEach(house => {
                house.position.z += 0.1;
                if (house.position.z > 0) house.position.set((Math.random() - 0.5) * 8, 1.5, -50);
            });

            pedestrians.forEach(ped => {
                ped.position.z += 0.1;
                if (ped.position.z > 0) ped.position.set((Math.random() - 0.5) * 8, 0.3, -50);
                if (Math.abs(ped.position.x - carX) < 0.8 && Math.abs(ped.position.z - car.position.z) < 1) {
                    gameActive = false;
                    document.getElementById('startPage').style.display = 'flex';
                }
            });

            car.position.x = carX;
            score += 1;
            document.getElementById('score').textContent = score;

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
